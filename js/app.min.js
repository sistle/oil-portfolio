const openCart=document.querySelector(".actions__basket"),productsDOM=document.querySelector(".products__wrapper"),totalProducts=document.querySelector(".actions__amount"),basket=document.querySelector(".cart__main"),totalAmount=document.querySelector(".cart__total"),clearCart=document.querySelectorAll(".cart__btn-remove ,.cart__btn-send");let cart=[],buttons=[];class UI{renderProducts(t){let e="";t.forEach((({id:t,title:a,descTop:o,descBottom:s,price:n,capacity:c,image:r})=>{e+=`\n\t\t\t\t<div class="swiper-slide products-card products-card__item--${t}">\n\t\t\t\t<div class="products-card__header">\n\t\t\t\t\t<img src="${r}" alt="olive" class="products-card__img">\n\t\t\t\t</div>\n\t\t\t\t<div class="products-card__main">\n\t\t\t\t\t<h3 class="products-card__title">${a}</h3>\n\t\t\t\t\t<div class="products-card__text">\n\t\t\t\t\t\t<p class="products-card__paragraph">${o}</p>\n\t\t\t\t\t\t<p class="products-card__paragraph"> ${s}</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="products-card__actions">\n\t\t\t\t\t<div class="products-card__desc">\n\t\t\t\t\t\t<div class="products-card__capacity">${c} мл</div>\n\t\t\t\t\t\t<div class="products-card__price">${n} грн</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="products-card__forms">\n\t\t\t\t\t\t<button class="products-card__btn btn" type="button" data-id=${t}>В КОРЗИНУ</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t`})),productsDOM.innerHTML=e}getButtons(){const t=[...document.querySelectorAll(".products-card__btn")];buttons=t,buttons.forEach((t=>{const e=t.dataset.id;t.addEventListener("click",(t=>{t.preventDefault(),t.target.disabled=!0,t.target.innerHTML="добавлено";const a={...Storage.getProducts(e),amount:1};cart=[...cart,a],Storage.saveCart(cart),this.setItemValues(cart),this.addToCart(a)}))}))}setItemValues(t){let e=0,a=0;t.map((t=>{e+=t.price*t.amount,a+=t.amount})),totalProducts.innerText=a,totalAmount.innerText=parseFloat(e.toFixed(2))}addToCart({title:t,price:e,capacity:a,image:o,id:s}){0==basket.children.length&&(basket.textContent="");let n=document.createElement("div");n.classList.add("cart-item"),n.innerHTML=`\n\t\t\t\t<div class="cart-item__top">\n\t\t\t\t\t<h4 class="cart-item__caption">${t}</h4>\n\t\t\t\t\t<p class="cart-item__capacity">${a} мл</p>\n\t\t\t\t</div>\n\t\t\t\t<div class="cart-item__content">\n\t\t\t\t\t<div class="cart-item__box">\n\t\t\t\t\t\t<img src="${o}" alt="olive" class="cart-item__img">\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cart-item__quantity">\n\t\t\t\t\t   <button type="button" class="cart-item__decrease icon__minus btn" data-id="${s}" ></button>\n\t\t\t\t\t   <span cart-item__amount>1</span>\n\t\t\t\t\t\t<button type="button" class="cart-item__increase icon__plus btn" data-id="${s}" ></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="cart-item__actions">\n\t\t\t\t\t\t<div class="cart-item__price">${e} грн</div>\n\t\t\t\t\t\t<button class="cart-item__btn btn--close icon__close " data-id="${s}" ></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t`,basket.appendChild(n)}setApp(){cart=Storage.checkLocalStorage(),this.setItemValues(cart),this.populate(cart)}populate(t){t.forEach((t=>this.addToCart(t)))}cardActions(t){clearCart.forEach((t=>{t.addEventListener("click",(t=>{console.log("work"),this.removeAllItems()}))})),basket.addEventListener("click",(t=>{const e=t.target.closest("button"),a=e.classList.contains("cart-item__btn");if(console.log(e),console.log("!!!"+a),e)if(a){const t=parseInt(e.dataset.id);this.removeItem(t),basket.removeChild(e.closest(".cart-item"))}else if(e.classList.contains("cart-item__increase")){const t=parseInt(e.dataset.id);let a=cart.find((e=>e.id===t));a.amount++,Storage.saveCart(cart),this.setItemValues(cart),e.previousElementSibling.innerText=a.amount}else if(e.classList.contains("cart-item__decrease")){const t=parseInt(e.dataset.id);let a=cart.find((e=>e.id===t));a.amount--,a.amount>0?(Storage.saveCart(cart),this.setItemValues(cart),e.nextElementSibling.innerText=a.amount):(this.removeItem(t),basket.removeChild(e.closest(".cart-item")))}}))}removeAllItems(){for(cart.map((t=>t.id)).forEach((t=>this.removeItem(t)));basket.children.length>0;)basket.removeChild(basket.children[0]);basket.textContent="Ваша корзина пуста!"}removeItem(t){cart=cart.filter((e=>e.id!==t)),this.setItemValues(cart),Storage.saveCart(cart);let e=this.validButton(t);e.disabled=!1,e.innerHTML="в корзину"}validButton(t){return buttons.find((e=>parseInt(e.dataset.id)===t))}}class Storage{static saveProducts(t){localStorage.setItem("Products",JSON.stringify(t))}static saveCart(t){localStorage.setItem("Cart",JSON.stringify(t))}static getProducts(t){return JSON.parse(localStorage.getItem("Products")).find((e=>e.id===parseFloat(t,10)))}static checkLocalStorage(){return localStorage.getItem("Cart")?JSON.parse(localStorage.getItem("Cart")):[]}}class Products{async getProducts(){return[{id:1,title:"Масло “Для салата”",descTop:"Название говорит само за себя. Это идеальная заправка, которая даже скучной и привычной капусте придаст неповторимый вкус и аромат. ",descBottom:"Состав: оливковое масло холодного отжима, розмарин, тимьян, базилик, орегано, чеснок, смесь из 5 перцев.",price:115,capacity:250,image:"img/card-bottle-salad.png"},{id:2,title:"Масло “Итальянское”",descTop:"Добавит ноток Италии в любое ваше блюдо. Паста, ризотто, пицца, салаты - его везде можно использовать.",descBottom:"Состав: оливковое масло холодного отжима, чеснок, вяленые томаты, базилик, орегано, майоран, смесь перцев.",price:115,capacity:250,image:"img/card-bottle-italy.png"},{id:3,title:"Масло “Для мяса”",descTop:"Идеальное решение для легкого и быстрого маринада мяса, можно добавить капельку масла и после приготовления. ",descBottom:"Состав: оливковое масло холодного отжима, чеснок, паприку, кориандр, смесь перцев, розмарин, тимьян, перец чили.",price:115,capacity:250,image:"img/card-bottle-meat.png"},{id:4,title:"Масло “Восточное”",descTop:"Oтлично подойдёт для блюд среднеазиатской кухни: шурпа, плов, лагман с этим маслом приобретут традиционные нотки Средней Азии.",descBottom:"Состав: оливковое масло холодного отжима, перец чили, зира, куркума, чеснок, смесь перцев.",price:115,capacity:250,image:"img/card-bottle-east.png"}]}}document.addEventListener("DOMContentLoaded",(async()=>{const t=new UI,e=new Products;t.setApp();const a=await e.getProducts();console.log(a),t.renderProducts(a),Storage.saveProducts(a),t.getButtons(),t.cardActions();new Swiper(".products__cards",{touchRatio:2,observer:!0,observeParents:!0,watchOverflow:!0,pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{320:{spaceBetween:0,slidesPerView:1},480:{spaceBetween:10,slidesPerView:2,spaceBetween:15},900:{slidesPerView:3,spaceBetween:20},1365.98:{spaceBetween:30,slidesPerView:4}}})}));let ua=window.navigator.userAgent,msie=ua.indexOf("MSIE "),isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()}};isMobile.any()?document.querySelector("html").classList.add("touch"):document.querySelector("html").classList.add("pc");const iconMenu=document.querySelector(".icon-menu"),menuBody=document.querySelector(".menu__body");function openCloseMenu(t){iconMenu&&open&&(open=!1,document.body.classList.toggle("lock"),iconMenu.classList.toggle("active"),menuBody.classList.toggle("active"),delay(500,!0))}iconMenu.addEventListener("click",openCloseMenu);const header=document.querySelector(".header"),navLinks=document.querySelectorAll(".menu__link ,.footer-nav__link , .footer__logo , .logo,.logo__img");function headeHendler(t,e){t[0].isIntersecting?header.classList.remove("scroll"):header.classList.add("scroll")}const headerObserver=new IntersectionObserver(headeHendler,{threshold:1});function sectionHendler(t){t.forEach((t=>{t.isIntersecting&&navLinks.forEach((e=>{const a=`${e.getAttribute("data-section").replace(".","")}`;t.target.classList.contains(a)?e.classList.add("active"):e.classList.remove("active")}))}))}headerObserver.observe(header);const observerOfSections=new IntersectionObserver(sectionHendler,{threshold:.7}),section=document.querySelectorAll("section").forEach((t=>{observerOfSections.observe(t)}));function navToSection(t){t.preventDefault();const e=t.target,a=document.querySelector(e.dataset.section).getBoundingClientRect().top+pageYOffset-header.offsetHeight;iconMenu.classList.contains("active")&&(document.body.classList.remove("lock"),iconMenu.classList.remove("active"),menuBody.classList.remove("active")),window.scrollTo({top:a,behavior:"smooth"})}navLinks.forEach((t=>{t.addEventListener("click",navToSection)}));const menu=["Для салата","Итальянское","Для мяса","Восточное"];new Swiper(".slider",{centeredSlides:!0,slidesPerView:1,observer:!0,observeParents:!0,watchOverflow:!0,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},hashNavigation:{watchState:!0},pagination:{el:".swiper-pagination",clickable:!0,renderBullet:function(t,e){return'<span class="'+e+' ">'+menu[t]+"</span>"}}}),new Swiper(".reviews__items",{slidesPerView:3,pagination:{el:".swiper-pagination",clickable:!0},breakpoints:{320:{spaceBetween:0,slidesPerView:1},768:{spaceBetween:10,slidesPerView:2},900:{slidesPerView:3}}});const popup=document.querySelectorAll("[data-popup] "),popupLinks=document.querySelectorAll(".btn--feedback, .actions__basket ,.slider__btn"),popupClose=document.querySelectorAll(".popup__btn-close,.popup"),popupBody=document.querySelectorAll(".popup__inner"),lockPadding=document.querySelectorAll(".lock-padding"),body=document.querySelector("body");let open=!0;function removePadding(t){body.style.paddingRight=t,lockPadding.forEach((e=>{e.style.paddingRight=t}))}function delay(t,e){setTimeout((()=>{open=e}),t)}function popupHandler(t){t.preventDefault();let e=this.dataset.popup;popup.forEach((t=>{e===t.dataset.popup&&modalOpen(t)}))}function modalOpen(t){if(null!=t&&open){removePadding(window.innerWidth-document.querySelector(".wrapper").offsetWidth+"px"),body.classList.add("lock"),t.classList.add("active"),delay(500,!1)}}function modalClose(t){open||(body.classList.remove("lock"),this.closest(".popup").classList.remove("active"),removePadding("0px"),delay(500,!0))}popupLinks.forEach((t=>{t.addEventListener("click",popupHandler)})),popupBody.forEach((t=>{t.addEventListener("click",(t=>{t.stopPropagation()}))})),popupClose.forEach((t=>{t.addEventListener("click",modalClose)}));